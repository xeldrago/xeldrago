<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The MathMaze - Math Challenge game</title>
    <style>
        /* All your CSS styles remain exactly the same */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #f1f1f1;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding-top: 20px;
        }

        h1 {
            font-size: 3rem;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #10b981);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
            text-shadow: 0 2px 15px rgba(59, 130, 246, 0.3);
        }

        .tagline {
            font-size: 1.3rem;
            color: #94a3b8;
            margin-bottom: 30px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
        }

        .game-area {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 40px;
        }

        .panel {
            background: rgba(30, 41, 59, 0.9);
            border-radius: 18px;
            padding: 28px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.08);
            flex: 1;
            min-width: 320px;
            backdrop-filter: blur(10px);
        }

        .config-panel {
            flex-basis: 380px;
        }

        .question-panel {
            flex: 2;
            min-width: 500px;
        }

        .panel-title {
            font-size: 1.7rem;
            color: #60a5fa;
            margin-bottom: 25px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(96, 165, 250, 0.4);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel-title::before {
            content: '';
            display: inline-block;
            width: 8px;
            height: 25px;
            background: linear-gradient(180deg, #3b82f6, #8b5cf6);
            border-radius: 4px;
        }

        .config-group {
            margin-bottom: 28px;
        }

        .config-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #e2e8f0;
            font-size: 1.1rem;
        }

        .radio-group,
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 18px;
            margin-top: 8px;
        }

        .radio-option,
        .checkbox-option {
            display: flex;
            align-items: center;
            background: rgba(15, 23, 42, 0.6);
            padding: 10px 15px;
            border-radius: 10px;
            transition: all 0.3s;
            border: 1px solid transparent;
        }

        .radio-option:hover,
        .checkbox-option:hover {
            border-color: #3b82f6;
            background: rgba(30, 41, 59, 0.9);
        }

        .radio-option input,
        .checkbox-option input {
            margin-right: 12px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .radio-option label,
        .checkbox-option label {
            cursor: pointer;
        }

        select,
        input[type="text"],
        input[type="number"] {
            width: 100%;
            padding: 14px 18px;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid #475569;
            border-radius: 10px;
            color: #f1f1f1;
            font-size: 1.05rem;
            transition: all 0.3s;
        }

        select:focus,
        input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
        }

        .player-inputs {
            display: flex;
            gap: 18px;
            margin-top: 12px;
        }

        .player-inputs input {
            flex: 1;
        }

        .btn {
            padding: 16px 28px;
            background: linear-gradient(90deg, #3b82f6, #6366f1);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.5);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn-shoot {
            background: linear-gradient(90deg, #f59e0b, #d97706);
            margin-top: 20px;
            width: 100%;
            font-size: 1.4rem;
            padding: 20px;
            letter-spacing: 1px;
        }

        .btn-shoot:hover {
            box-shadow: 0 8px 20px rgba(245, 158, 11, 0.5);
        }

        .btn-shoot:disabled {
            background: #475569;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .question-display {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.95), rgba(30, 41, 59, 0.95));
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border-left: 6px solid #3b82f6;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.3);
        }

        .question-text {
            font-size: 2.3rem;
            text-align: center;
            margin-bottom: 15px;
            color: #f8fafc;
            font-weight: 600;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .question-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .question-level {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .level-1 {
            background: linear-gradient(90deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.1));
            color: #4ade80;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .level-2 {
            background: linear-gradient(90deg, rgba(245, 158, 11, 0.2), rgba(245, 158, 11, 0.1));
            color: #fbbf24;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .level-3 {
            background: linear-gradient(90deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1));
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .question-counter {
            color: #94a3b8;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .option-btn {
            padding: 25px 20px;
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid #475569;
            border-radius: 12px;
            color: #e2e8f0;
            font-size: 1.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .option-btn:hover {
            transform: translateY(-3px);
            background: rgba(30, 41, 59, 0.9);
            border-color: #3b82f6;
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }

        .option-btn.selected {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(96, 165, 250, 0.1));
            border-color: #3b82f6;
            color: #60a5fa;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }

        .option-btn.correct {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(74, 222, 128, 0.1));
            border-color: #4ade80;
            color: #4ade80;
        }

        .option-btn.incorrect {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(248, 113, 113, 0.1));
            border-color: #f87171;
            color: #f87171;
        }

        .btn-submit {
            width: 100%;
            font-size: 1.3rem;
            padding: 20px;
            margin-top: 10px;
        }

        .scoreboard {
            display: flex;
            justify-content: space-around;
            margin-top: 25px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .player-score {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.9));
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            flex: 1;
            min-width: 180px;
            border: 2px solid transparent;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .player-score::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
        }

        .player-score.active {
            border-color: #3b82f6;
            box-shadow: 0 0 25px rgba(59, 130, 246, 0.4);
            transform: translateY(-5px);
        }

        .player-name {
            font-size: 1.4rem;
            margin-bottom: 15px;
            color: #e2e8f0;
            font-weight: 600;
        }

        .player-score-value {
            font-size: 3rem;
            font-weight: 800;
            color: #60a5fa;
            text-shadow: 0 2px 10px rgba(96, 165, 250, 0.3);
        }

        .game-log {
            background: rgba(15, 23, 42, 0.8);
            border-radius: 15px;
            padding: 25px;
            margin-top: 25px;
            max-height: 300px;
            overflow-y: auto;
        }

        .log-title {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: #94a3b8;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .log-title::before {
            content: 'üìä';
            font-size: 1.2rem;
        }

        .log-entry {
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 1rem;
        }

        .log-entry::before {
            content: '‚Ä¢';
            color: #3b82f6;
            font-size: 1.5rem;
            margin-right: 10px;
        }

        .log-entry.correct {
            color: #4ade80;
        }

        .log-entry.correct::before {
            content: '‚úì';
            color: #4ade80;
        }

        .log-entry.incorrect {
            color: #f87171;
        }

        .log-entry.incorrect::before {
            content: '‚úó';
            color: #f87171;
        }

        .log-question {
            font-weight: 600;
            margin: 8px 0 5px 20px;
            color: #e2e8f0;
        }

        .log-solution {
            margin: 5px 0 8px 20px;
            padding: 10px;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 8px;
            border-left: 3px solid #3b82f6;
            font-size: 0.9rem;
            color: #cbd5e1;
        }

        .log-solution-step {
            margin: 3px 0;
            padding-left: 10px;
        }

        .log-details {
            font-size: 0.9rem;
            color: #94a3b8;
            margin-top: 5px;
            padding-left: 25px;
        }

        .hidden {
            display: none !important;
        }

        .current-player {
            text-align: center;
            font-size: 1.6rem;
            margin-bottom: 25px;
            color: #fbbf24;
            font-weight: 700;
            padding: 15px;
            background: rgba(245, 158, 11, 0.1);
            border-radius: 12px;
            border: 2px solid rgba(245, 158, 11, 0.3);
        }

        .result-feedback {
            text-align: center;
            font-size: 1.5rem;
            margin-top: 20px;
            min-height: 50px;
            font-weight: 700;
            padding: 15px;
            border-radius: 12px;
        }

        .correct-answer {
            color: #4ade80;
            background: rgba(34, 197, 94, 0.1);
            border: 2px solid rgba(34, 197, 94, 0.3);
        }

        .incorrect-answer {
            color: #f87171;
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid rgba(239, 68, 68, 0.3);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .stat-item {
            background: rgba(30, 41, 59, 0.7);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #60a5fa;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #94a3b8;
            margin-top: 5px;
        }

        /* Category Selection Styles */
        .category-selection {
            margin-bottom: 25px;
        }

        .category-item {
            background: rgba(15, 23, 42, 0.6);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border: 2px solid transparent;
            transition: all 0.3s;
            cursor: pointer;
        }

        .category-item:hover {
            border-color: #3b82f6;
            background: rgba(30, 41, 59, 0.8);
            transform: translateY(-2px);
        }

        .category-item.selected {
            border-color: #3b82f6;
            background: rgba(30, 41, 59, 0.9);
            box-shadow: 0 5px 20px rgba(59, 130, 246, 0.3);
        }

        .category-title {
            font-size: 1.3rem;
            color: #e2e8f0;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .category-description {
            color: #94a3b8;
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .levels-container {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .level-btn {
            flex: 1;
            padding: 10px;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid #475569;
            border-radius: 8px;
            color: #e2e8f0;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-size: 0.9rem;
        }

        .level-btn:hover {
            border-color: #3b82f6;
            background: rgba(30, 41, 59, 0.9);
        }

        .level-btn.selected {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(96, 165, 250, 0.1));
            border-color: #3b82f6;
            color: #60a5fa;
            font-weight: 600;
        }

        .difficulty-dots {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
        }

        .dot.active {
            background: #3b82f6;
        }

        @media (max-width: 1024px) {
            .game-area {
                flex-direction: column;
            }

            .panel {
                min-width: 100%;
            }

            .question-text {
                font-size: 1.8rem;
            }

            .options-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }

            .question-text {
                font-size: 1.6rem;
            }

            .player-score-value {
                font-size: 2.5rem;
            }

            .option-btn {
                padding: 20px 15px;
                font-size: 1.3rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>The MathMaze - Advanced Challenge</h1>
            <p class="tagline">Master mathematics with challenging multiple-choice questions. Each category has 3 levels
                of increasing difficulty with tough, non-decimal options!</p>
        </header>

        <div class="game-area">
            <!-- Configuration Panel -->
            <div class="panel config-panel">
                <h2 class="panel-title">Game Configuration</h2>

                <div class="config-group">
                    <label class="config-label">Game Mode</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="gameMode" value="single" checked>
                            <span>Single Player</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="gameMode" value="multi">
                            <span>Two Players</span>
                        </label>
                    </div>
                </div>

                <!-- Category Selection -->
                <div class="category-selection">
                    <div class="category-item selected" data-category="multiplication">
                        <div class="category-title">
                            <span>üî¢ Multiplications & Squares</span>
                        </div>
                        <div class="difficulty-dots">
                            <div class="dot active"></div>
                            <div class="dot active"></div>
                            <div class="dot active"></div>
                        </div>
                        <div class="category-description">
                            Level 1: Single-digit operations<br>
                            Level 2: Double-digit operations<br>
                            Level 3: Triple-digit operations with squares
                        </div>
                        <div class="levels-container">
                            <button class="level-btn selected" data-level="1">Level 1</button>
                            <button class="level-btn" data-level="2">Level 2</button>
                            <button class="level-btn" data-level="3">Level 3</button>
                        </div>
                    </div>

                    <div class="category-item" data-category="mixed">
                        <div class="category-title">
                            <span>üßÆ Mixed Operations</span>
                        </div>
                        <div class="difficulty-dots">
                            <div class="dot active"></div>
                            <div class="dot active"></div>
                            <div class="dot active"></div>
                        </div>
                        <div class="category-description">
                            Level 1: Basic BODMAS with integers<br>
                            Level 2: Advanced BODMAS with fractions<br>
                            Level 3: Complex operations with exponents
                        </div>
                        <div class="levels-container">
                            <button class="level-btn" data-level="1">Level 1</button>
                            <button class="level-btn" data-level="2">Level 2</button>
                            <button class="level-btn" data-level="3">Level 3</button>
                        </div>
                    </div>

                    <div class="category-item" data-category="algebra">
                        <div class="category-title">
                            <span>üìê Algebra & Equations</span>
                        </div>
                        <div class="difficulty-dots">
                            <div class="dot active"></div>
                            <div class="dot active"></div>
                            <div class="dot active"></div>
                        </div>
                        <div class="category-description">
                            Level 1: Single variable equations<br>
                            Level 2: Two-variable equations<br>
                            Level 3: Three-variable & quadratic equations
                        </div>
                        <div class="levels-container">
                            <button class="level-btn" data-level="1">Level 1</button>
                            <button class="level-btn" data-level="2">Level 2</button>
                            <button class="level-btn" data-level="3">Level 3</button>
                        </div>
                    </div>
                </div>

                <div class="config-group">
                    <label class="config-label">Number of Questions</label>
                    <select id="questionCount">
                        <option value="5">5 Questions</option>
                        <option value="10" selected>10 Questions</option>
                        <option value="15">15 Questions</option>
                        <option value="20">20 Questions</option>
                        <option value="30">30 Questions</option>
                    </select>
                </div>

                <div id="playerNamesGroup" class="config-group hidden">
                    <label class="config-label">Player Names</label>
                    <div class="player-inputs">
                        <input type="text" id="player1Name" placeholder="Player 1" value="Player 1">
                        <input type="text" id="player2Name" placeholder="Player 2" value="Player 2">
                    </div>
                </div>

                <div class="config-group">
                    <button id="startGame" class="btn">
                        <span>üöÄ</span> Start Game
                    </button>
                </div>

                <div class="config-group">
                    <button id="shootBtn" class="btn btn-shoot" disabled>
                        <span>üí•</span> GENERATE QUESTION <span>üß†</span>
                    </button>
                </div>

                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="totalQuestionsStat">500+</div>
                        <div class="stat-label">Question Variations</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="level1Questions">250+</div>
                        <div class="stat-label">Multiplication Questions</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="level2Questions">150+</div>
                        <div class="stat-label">Mixed Operations</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="level3Questions">100+</div>
                        <div class="stat-label">Algebra Equations</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">4</div>
                        <div class="stat-label">Multiple Choice Options</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">‚àû</div>
                        <div class="stat-label">Random Combinations</div>
                    </div>
                </div>
            </div>

            <!-- Question & Game Panel -->
            <div class="panel question-panel">
                <h2 class="panel-title">Math Challenge Arena</h2>

                <div id="gameSetup" class="question-display">
                    <p style="font-size: 1.4rem; text-align: center; margin-bottom: 20px;">Select a category and level,
                        then click "Start Game" to begin!</p>
                    <div style="background: rgba(15, 23, 42, 0.6); padding: 20px; border-radius: 12px;">
                        <p style="font-size: 1.2rem; color: #94a3b8; margin-bottom: 10px;">
                            <strong>üéØ Game Features:</strong>
                        </p>
                        <ul style="padding-left: 20px; color: #cbd5e1; line-height: 1.6;">
                            <li><strong>3 Categories</strong> with 3 difficulty levels each</li>
                            <li><strong>No easy decimals</strong> - All answers are integers</li>
                            <li><strong>Tough distractors</strong> - Options are close but wrong (e.g., 7√ó8 = 56, 54,
                                55, 58)</li>
                            <li><strong>Category 1:</strong> Multiplications & Squares (Single to Triple-digit)</li>
                            <li><strong>Category 2:</strong> Mixed Operations (BODMAS, fractions, exponents)</li>
                            <li><strong>Category 3:</strong> Algebra & Equations (Single to Multiple variables)</li>
                            <li>Detailed game log shows chosen vs correct options</li>
                            <li><strong>Step-by-step solutions</strong> for learning</li>
                        </ul>
                    </div>
                </div>

                <div id="gameActive" class="hidden">
                    <div id="currentPlayerDisplay" class="current-player hidden"></div>

                    <div class="question-display">
                        <div class="question-details">
                            <div id="questionLevel" class="question-level">Level 1</div>
                            <div id="questionCounter" class="question-counter">Question 1/10</div>
                        </div>
                        <div id="questionText" class="question-text">Click "GENERATE QUESTION" to get your first
                            question</div>
                    </div>

                    <div id="answerSection" class="hidden">
                        <div class="options-grid" id="optionsContainer">
                            <!-- Options will be generated here -->
                        </div>
                        <button id="submitAnswer" class="btn btn-submit" disabled>Submit Answer</button>
                        <div id="resultFeedback" class="result-feedback"></div>
                    </div>

                    <div class="scoreboard">
                        <div class="player-score" id="player1ScoreCard">
                            <div class="player-name" id="player1NameDisplay">Player 1</div>
                            <div class="player-score-value" id="player1Score">0</div>
                        </div>

                        <div class="player-score hidden" id="player2ScoreCard">
                            <div class="player-name" id="player2NameDisplay">Player 2</div>
                            <div class="player-score-value" id="player2Score">0</div>
                        </div>
                    </div>

                    <div class="game-log">
                        <div class="log-title">Game Log with Solutions</div>
                        <div id="logEntries"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game state
        let gameState = {
            mode: 'single',
            currentCategory: 'multiplication',
            currentLevel: 1,
            totalQuestions: 10,
            currentQuestion: 0,
            currentPlayer: 1,
            player1Score: 0,
            player2Score: 0,
            player1Name: 'Player 1',
            player2Name: 'Player 2',
            gameActive: false,
            currentQuestionData: null,
            questionsAnswered: 0,
            selectedOption: null
        };

        // Question banks
        const questionBank = {
            multiplication: { level1: [], level2: [], level3: [] },
            mixed: { level1: [], level2: [], level3: [] },
            algebra: { level1: [], level2: [], level3: [] }
        };

        // Initialize question banks
        function initializeQuestionBanks() {
            // Clear existing questions
            for (let category in questionBank) {
                for (let level in questionBank[category]) {
                    questionBank[category][level] = [];
                }
            }

            // Multiplication Level 1 (1-9 √ó 1-9)
            for (let i = 0; i < 50; i++) {
                const num1 = Math.floor(Math.random() * 9) + 1;
                const num2 = Math.floor(Math.random() * 9) + 1;
                const answer = num1 * num2;
                questionBank.multiplication.level1.push({
                    question: `${num1} √ó ${num2} = ?`,
                    answer: answer,
                    type: 'multiplication',
                    numbers: [num1, num2],
                    solutionSteps: [
                        `Step 1: Multiply ${num1} √ó ${num2}`,
                        `Step 2: ${num1} √ó ${num2} = ${answer}`,
                        `Step 3: Therefore, ${num1} √ó ${num2} = ${answer}`
                    ]
                });
            }

            // Add squares for multiplication level 1
            for (let i = 0; i < 25; i++) {
                const num = Math.floor(Math.random() * 9) + 1;
                const answer = num * num;
                questionBank.multiplication.level1.push({
                    question: `${num}¬≤ = ?`,
                    answer: answer,
                    type: 'square',
                    numbers: [num],
                    solutionSteps: [
                        `Step 1: Square of ${num} means ${num} √ó ${num}`,
                        `Step 2: ${num} √ó ${num} = ${answer}`,
                        `Step 3: Therefore, ${num}¬≤ = ${answer}`
                    ]
                });
            }

            // Multiplication Level 2 (10-99 √ó 2-9)
            for (let i = 0; i < 50; i++) {
                const num1 = Math.floor(Math.random() * 90) + 10;
                const num2 = Math.floor(Math.random() * 8) + 2;
                const answer = num1 * num2;
                questionBank.multiplication.level2.push({
                    question: `${num1} √ó ${num2} = ?`,
                    answer: answer,
                    type: 'multiplication',
                    numbers: [num1, num2],
                    solutionSteps: [
                        `Step 1: Multiply ${num1} √ó ${num2}`,
                        `Step 2: ${num1} √ó ${num2} = ${answer}`,
                        `Step 3: Therefore, ${num1} √ó ${num2} = ${answer}`
                    ]
                });
            }

            // Multiplication Level 3 (100-999 √ó 2-9)
            for (let i = 0; i < 50; i++) {
                const num1 = Math.floor(Math.random() * 900) + 100;
                const num2 = Math.floor(Math.random() * 8) + 2;
                const answer = num1 * num2;
                questionBank.multiplication.level3.push({
                    question: `${num1} √ó ${num2} = ?`,
                    answer: answer,
                    type: 'multiplication',
                    numbers: [num1, num2],
                    solutionSteps: [
                        `Step 1: Multiply ${num1} √ó ${num2}`,
                        `Step 2: ${num1} √ó ${num2} = ${answer}`,
                        `Step 3: Therefore, ${num1} √ó ${num2} = ${answer}`
                    ]
                });
            }

            // Mixed Operations Level 1 (simple BODMAS)
            for (let i = 0; i < 50; i++) {
                const a = Math.floor(Math.random() * 10) + 1;
                const b = Math.floor(Math.random() * 10) + 1;
                const c = Math.floor(Math.random() * 10) + 1;
                const expressions = [
                    `${a} + ${b} √ó ${c}`,
                    `${a} √ó ${b} - ${c}`,
                    `(${a} + ${b}) √ó ${c}`,
                    `${a} √ó ${b} √∑ ${c}`
                ];
                const expr = expressions[Math.floor(Math.random() * expressions.length)];
                const answer = Math.round(eval(expr.replace('√ó', '*').replace('√∑', '/')));
                if (Number.isInteger(answer)) {
                    questionBank.mixed.level1.push({
                        question: `${expr} = ?`,
                        answer: answer,
                        type: 'mixed',
                        numbers: null,
                        solutionSteps: [
                            `Step 1: Evaluate expression: ${expr}`,
                            `Step 2: Following BODMAS/PEMDAS rules`,
                            `Step 3: ${expr} = ${answer}`
                        ]
                    });
                }
            }

            // Mixed Operations Level 2 (intermediate BODMAS)
            for (let i = 0; i < 50; i++) {
                const a = Math.floor(Math.random() * 15) + 1;
                const b = Math.floor(Math.random() * 15) + 1;
                const c = Math.floor(Math.random() * 15) + 1;
                const d = Math.floor(Math.random() * 10) + 1;
                const expressions = [
                    `(${a} + ${b}) √ó (${c} - ${d})`,
                    `${a} √ó ${b} √∑ ${c} + ${d}`,
                    `(${a} √ó ${b}) - (${c} √∑ ${d})`
                ];
                const expr = expressions[Math.floor(Math.random() * expressions.length)];
                const answer = Math.round(eval(expr.replace('√ó', '*').replace('√∑', '/')));
                if (Number.isInteger(answer)) {
                    questionBank.mixed.level2.push({
                        question: `${expr} = ?`,
                        answer: answer,
                        type: 'mixed',
                        numbers: null,
                        solutionSteps: [
                            `Step 1: Evaluate expression: ${expr}`,
                            `Step 2: Following BODMAS/PEMDAS rules`,
                            `Step 3: ${expr} = ${answer}`
                        ]
                    });
                }
            }

            // Mixed Operations Level 3 (advanced with exponents)
            for (let i = 0; i < 50; i++) {
                const a = Math.floor(Math.random() * 10) + 1;
                const b = Math.floor(Math.random() * 10) + 1;
                const c = Math.floor(Math.random() * 10) + 1;
                const expressions = [
                    `${a}¬≤ + ${b} √ó ${c}`,
                    `${a} √ó ${b}¬≤ - ${c}`,
                    `(${a} + ${b})¬≤ √∑ ${c}`
                ];
                const expr = expressions[Math.floor(Math.random() * expressions.length)];
                const answer = Math.round(eval(expr.replace('√ó', '*').replace('√∑', '/').replace('¬≤', '**2')));
                if (Number.isInteger(answer)) {
                    questionBank.mixed.level3.push({
                        question: `${expr} = ?`,
                        answer: answer,
                        type: 'mixed',
                        numbers: null,
                        solutionSteps: [
                            `Step 1: Evaluate expression: ${expr}`,
                            `Step 2: Following BODMAS/PEMDAS rules`,
                            `Step 3: ${expr} = ${answer}`
                        ]
                    });
                }
            }

            // Algebra Level 1 (single variable)
            for (let i = 0; i < 50; i++) {
                const a = Math.floor(Math.random() * 10) + 1;
                const b = Math.floor(Math.random() * 20) + 1;
                const x = Math.floor(Math.random() * 10) + 1;
                const answer = a * x + b;
                questionBank.algebra.level1.push({
                    question: `${a}x + ${b} = ${answer}`,
                    answer: x,
                    type: 'algebra',
                    numbers: [a, b, answer],
                    solutionSteps: [
                        `Step 1: Given equation: ${a}x + ${b} = ${answer}`,
                        `Step 2: Subtract ${b} from both sides: ${a}x = ${answer} - ${b} = ${answer - b}`,
                        `Step 3: Divide by ${a}: x = ${answer - b} √∑ ${a} = ${x}`,
                        `Step 4: Therefore, x = ${x}`
                    ]
                });
            }

            // Algebra Level 2 (two variables simple)
            for (let i = 0; i < 50; i++) {
                const x = Math.floor(Math.random() * 10) + 1;
                const y = Math.floor(Math.random() * 10) + 1;
                const a1 = Math.floor(Math.random() * 5) + 1;
                const b1 = Math.floor(Math.random() * 5) + 1;
                const a2 = Math.floor(Math.random() * 5) + 1;
                const b2 = Math.floor(Math.random() * 5) + 1;

                const eq1 = a1 * x + b1 * y;
                const eq2 = a2 * x + b2 * y;

                questionBank.algebra.level2.push({
                    question: `${a1}x + ${b1}y = ${eq1}<br>${a2}x + ${b2}y = ${eq2}`,
                    answer: `x=${x}, y=${y}`,
                    type: 'algebra',
                    numbers: [a1, b1, eq1, a2, b2, eq2],
                    solutionSteps: [
                        `Step 1: Given equations:`,
                        `   1) ${a1}x + ${b1}y = ${eq1}`,
                        `   2) ${a2}x + ${b2}y = ${eq2}`,
                        `Step 2: Multiply equation 1 by ${a2}: ${a1 * a2}x + ${b1 * a2}y = ${eq1 * a2}`,
                        `Step 3: Multiply equation 2 by ${a1}: ${a1 * a2}x + ${b2 * a1}y = ${eq2 * a1}`,
                        `Step 4: Subtract equations: (${b1 * a2 - b2 * a1})y = ${eq1 * a2 - eq2 * a1}`,
                        `Step 5: Solve for y: y = ${y}`,
                        `Step 6: Substitute y=${y} into equation 1: ${a1}x + ${b1 * y} = ${eq1}`,
                        `Step 7: ${a1}x + ${b1 * y} = ${eq1}`,
                        `Step 8: ${a1}x = ${eq1 - b1 * y}`,
                        `Step 9: x = ${x}`,
                        `Step 10: Solution: x=${x}, y=${y}`
                    ]
                });
            }

            // Algebra Level 3 (quadratic)
            for (let i = 0; i < 50; i++) {
                const x1 = Math.floor(Math.random() * 10) + 1;
                const x2 = Math.floor(Math.random() * 10) + 1;
                const a = 1;
                const b = -(x1 + x2);
                const c = x1 * x2;

                questionBank.algebra.level3.push({
                    question: `x¬≤ ${b >= 0 ? '+' : ''}${b}x ${c >= 0 ? '+' : ''}${c} = 0`,
                    answer: `x=${x1}, x=${x2}`,
                    type: 'algebra',
                    numbers: [b, c],
                    solutionSteps: [
                        `Step 1: Quadratic equation: x¬≤ ${b >= 0 ? '+' : ''}${b}x ${c >= 0 ? '+' : ''}${c} = 0`,
                        `Step 2: Discriminant = b¬≤ - 4ac = ${b}¬≤ - 4√ó1√ó${c} = ${b * b - 4 * c}`,
                        `Step 3: ‚àöDiscriminant = ${Math.sqrt(b * b - 4 * c)}`,
                        `Step 4: x = [-b ¬± ‚àö(b¬≤-4ac)] / 2a = [${-b} ¬± ${Math.sqrt(b * b - 4 * c)}] / 2`,
                        `Step 5: x‚ÇÅ = [${-b} + ${Math.sqrt(b * b - 4 * c)}] / 2 = ${x1}`,
                        `Step 6: x‚ÇÇ = [${-b} - ${Math.sqrt(b * b - 4 * c)}] / 2 = ${x2}`,
                        `Step 7: Solutions: x=${x1}, x=${x2}`
                    ]
                });
            }

            // Update stats display
            const totalQuestions =
                questionBank.multiplication.level1.length + questionBank.multiplication.level2.length + questionBank.multiplication.level3.length +
                questionBank.mixed.level1.length + questionBank.mixed.level2.length + questionBank.mixed.level3.length +
                questionBank.algebra.level1.length + questionBank.algebra.level2.length + questionBank.algebra.level3.length;

            document.getElementById('totalQuestionsStat').textContent = `${totalQuestions}+`;
            document.getElementById('level1Questions').textContent = `${questionBank.multiplication.level1.length + questionBank.multiplication.level2.length + questionBank.multiplication.level3.length}+`;
            document.getElementById('level2Questions').textContent = `${questionBank.mixed.level1.length + questionBank.mixed.level2.length + questionBank.mixed.level3.length}+`;
            document.getElementById('level3Questions').textContent = `${questionBank.algebra.level1.length + questionBank.algebra.level2.length + questionBank.algebra.level3.length}+`;
        }

        // Generate SMART options that have the same last digit
        function generateOptions(correctAnswer, questionText) {
            const correct = typeof correctAnswer === 'string' ? correctAnswer : correctAnswer;
            const options = [correct];

            // Check if it's a multiplication question
            const isMultiplication = questionText.includes('√ó');

            if (typeof correct === 'number' && isMultiplication) {
                // For multiplication questions, generate distractors with same last digit
                const lastDigit = correct % 10;

                for (let i = 0; i < 3; i++) {
                    let wrongAnswer;
                    let attempts = 0;

                    do {
                        attempts++;
                        if (attempts > 10) break;

                        // Try different strategies
                        const offset = (Math.floor(Math.random() * 5) + 1) * 10;
                        const sign = Math.random() > 0.5 ? 1 : -1;
                        wrongAnswer = correct + sign * offset;

                        // Ensure it has the same last digit
                        wrongAnswer = Math.floor(wrongAnswer / 10) * 10 + lastDigit;

                        // Ensure it's positive and different
                        if (wrongAnswer <= 0 || wrongAnswer === correct || options.includes(wrongAnswer)) {
                            continue;
                        }

                    } while (wrongAnswer <= 0 || wrongAnswer === correct || options.includes(wrongAnswer));

                    if (wrongAnswer && wrongAnswer > 0 && wrongAnswer !== correct && !options.includes(wrongAnswer)) {
                        options.push(wrongAnswer);
                    }
                }

                // If we couldn't generate enough unique options, fill with generic ones
                while (options.length < 4) {
                    let wrongAnswer;
                    do {
                        const offset = Math.floor(Math.random() * 20) + 1;
                        const sign = Math.random() > 0.5 ? 1 : -1;
                        wrongAnswer = correct + sign * offset;
                        // Ensure same last digit
                        wrongAnswer = Math.floor(wrongAnswer / 10) * 10 + lastDigit;
                    } while (wrongAnswer <= 0 || options.includes(wrongAnswer));
                    options.push(wrongAnswer);
                }
            } else {
                // For non-multiplication questions, use standard generation
                for (let i = 0; i < 3; i++) {
                    let wrongAnswer;
                    if (typeof correct === 'string') {
                        // For algebra answers
                        if (correct.includes('x=')) {
                            const parts = correct.split(', ');
                            const modifiedParts = parts.map(part => {
                                const [varName, valueStr] = part.split('=');
                                const value = parseInt(valueStr);
                                const offset = Math.floor(Math.random() * 3) + 1;
                                const sign = Math.random() > 0.5 ? 1 : -1;
                                return `${varName}=${value + sign * offset}`;
                            });
                            wrongAnswer = modifiedParts.join(', ');
                        } else {
                            wrongAnswer = correct + " (wrong)";
                        }
                    } else {
                        // For numeric answers
                        const offset = Math.floor(Math.random() * 10) + 1;
                        const sign = Math.random() > 0.5 ? 1 : -1;
                        wrongAnswer = correct + sign * offset;

                        if (wrongAnswer === correct || options.includes(wrongAnswer)) {
                            i--;
                            continue;
                        }
                    }
                    options.push(wrongAnswer);
                }
            }

            // Shuffle options
            for (let i = options.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [options[i], options[j]] = [options[j], options[i]];
            }

            return options;
        }

        // Helper functions
        function getCurrentPlayerName() {
            if (gameState.mode === 'single') return 'You';
            return gameState.currentPlayer === 1 ? gameState.player1Name : gameState.player2Name;
        }

        function updateCurrentPlayerDisplay() {
            const display = document.getElementById('currentPlayerDisplay');
            display.textContent = `${getCurrentPlayerName()}'s turn`;
        }

        function updatePlayerScoreCards() {
            const player1Card = document.getElementById('player1ScoreCard');
            const player2Card = document.getElementById('player2ScoreCard');

            player1Card.classList.remove('active');
            player2Card.classList.remove('active');

            if (gameState.mode === 'multi') {
                if (gameState.currentPlayer === 1) {
                    player1Card.classList.add('active');
                } else {
                    player2Card.classList.add('active');
                }
            }
        }

        function updateQuestionCounter() {
            document.getElementById('questionCounter').textContent =
                `Question ${gameState.questionsAnswered + 1}/${gameState.totalQuestions}`;
        }

        function addLogEntry(message, type = '', questionData = null) {
            const logEntries = document.getElementById('logEntries');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `${gameState.questionsAnswered + 1}. ${message}`;
            logEntries.appendChild(entry);

            // Add question and solution if provided
            if (questionData) {
                const questionEl = document.createElement('div');
                questionEl.className = 'log-question';
                questionEl.innerHTML = `Q: ${questionData.question}`;
                logEntries.appendChild(questionEl);

                const solutionEl = document.createElement('div');
                solutionEl.className = 'log-solution';

                if (questionData.solutionSteps && questionData.solutionSteps.length > 0) {
                    solutionEl.innerHTML = '<strong>Solution Steps:</strong>';
                    questionData.solutionSteps.forEach(step => {
                        const stepEl = document.createElement('div');
                        stepEl.className = 'log-solution-step';
                        stepEl.textContent = step;
                        solutionEl.appendChild(stepEl);
                    });
                } else {
                    solutionEl.textContent = `Solution: ${questionData.answer}`;
                }
                logEntries.appendChild(solutionEl);
            }

            logEntries.scrollTop = logEntries.scrollHeight;
        }

        function checkAnswer() {
            if (!gameState.currentQuestionData || !gameState.selectedOption) return;

            const correctAnswer = gameState.currentQuestionData.answer;
            const isCorrect = gameState.selectedOption == correctAnswer;

            // Update option buttons UI
            document.querySelectorAll('.option-btn').forEach(btn => {
                const btnValue = btn.dataset.value;
                if (btnValue == correctAnswer) {
                    btn.classList.add('correct');
                } else if (btnValue == gameState.selectedOption) {
                    btn.classList.add('incorrect');
                }
                btn.disabled = true;
            });

            // Update score if correct
            if (isCorrect) {
                const points = gameState.currentLevel * 10;
                if (gameState.currentPlayer === 1) {
                    gameState.player1Score += points;
                    document.getElementById('player1Score').textContent = gameState.player1Score;
                } else {
                    gameState.player2Score += points;
                    document.getElementById('player2Score').textContent = gameState.player2Score;
                }

                document.getElementById('resultFeedback').textContent = `Correct! +${points} points`;
                document.getElementById('resultFeedback').className = 'result-feedback correct-answer';
                addLogEntry(`${getCurrentPlayerName()} chose ${gameState.selectedOption} (Correct! +${points} points)`, 'correct', gameState.currentQuestionData);
            } else {
                document.getElementById('resultFeedback').textContent = `Incorrect. Correct answer: ${correctAnswer}`;
                document.getElementById('resultFeedback').className = 'result-feedback incorrect-answer';
                addLogEntry(`${getCurrentPlayerName()} chose ${gameState.selectedOption} (Incorrect)`, 'incorrect', gameState.currentQuestionData);
            }

            // Update game state
            gameState.questionsAnswered++;
            gameState.selectedOption = null;

            // Switch player in multiplayer mode
            if (gameState.mode === 'multi') {
                gameState.currentPlayer = gameState.currentPlayer === 1 ? 2 : 1;
                updateCurrentPlayerDisplay();
                updatePlayerScoreCards();
            }

            // Check if game is over
            if (gameState.questionsAnswered >= gameState.totalQuestions) {
                setTimeout(endGame, 2000);
            } else {
                // Re-enable shoot button after delay
                setTimeout(() => {
                    document.getElementById('shootBtn').disabled = false;
                    document.getElementById('answerSection').classList.add('hidden');
                    document.getElementById('questionText').textContent = 'Click "GENERATE QUESTION" for next question';
                    document.getElementById('resultFeedback').textContent = '';
                    document.getElementById('submitAnswer').disabled = true;
                }, 2000);
            }
        }

        function endGame() {
            gameState.gameActive = false;

            let winnerMessage = '';
            if (gameState.mode === 'multi') {
                if (gameState.player1Score > gameState.player2Score) {
                    winnerMessage = `üéâ ${gameState.player1Name} wins!`;
                } else if (gameState.player2Score > gameState.player1Score) {
                    winnerMessage = `üéâ ${gameState.player2Name} wins!`;
                } else {
                    winnerMessage = "ü§ù It's a tie!";
                }
            } else {
                winnerMessage = `üèÅ Game over! Your score: ${gameState.player1Score}`;
            }

            const categoryNames = {
                multiplication: 'Multiplications & Squares',
                mixed: 'Mixed Operations',
                algebra: 'Algebra & Equations'
            };

            document.getElementById('questionText').innerHTML = `
                <div style="font-size: 2rem; color: #fbbf24; margin-bottom: 20px;">üèÜ Game Complete!</div>
                <div style="font-size: 1.6rem; margin-bottom: 15px;">${winnerMessage}</div>
                <div style="font-size: 1.3rem; color: #94a3b8; margin-bottom: 10px;">
                    Category: ${categoryNames[gameState.currentCategory]} - Level ${gameState.currentLevel}
                </div>
            `;

            document.getElementById('answerSection').classList.add('hidden');
            document.getElementById('shootBtn').disabled = true;
            addLogEntry(`Game over! ${winnerMessage}`);
        }

        // Initialize game when DOM is loaded
        document.addEventListener('DOMContentLoaded', function () {
            console.log("DOM loaded, initializing game...");

            // Initialize question banks
            initializeQuestionBanks();

            // Category selection - SIMPLIFIED
            document.querySelectorAll('.category-item').forEach(item => {
                item.addEventListener('click', function () {
                    console.log("Category clicked:", this.dataset.category);
                    // Remove selected class from all categories
                    document.querySelectorAll('.category-item').forEach(cat => {
                        cat.classList.remove('selected');
                    });

                    // Add selected class to clicked category
                    this.classList.add('selected');

                    // Update game state
                    gameState.currentCategory = this.dataset.category;

                    // Reset level to 1 for this category
                    const levelBtns = this.querySelectorAll('.level-btn');
                    levelBtns.forEach(btn => btn.classList.remove('selected'));
                    if (levelBtns[0]) levelBtns[0].classList.add('selected');
                    gameState.currentLevel = 1;

                    console.log("Selected category:", gameState.currentCategory, "level:", gameState.currentLevel);
                });
            });

            // Level button selection within categories - SIMPLIFIED
            document.querySelectorAll('.level-btn').forEach(btn => {
                btn.addEventListener('click', function (e) {
                    e.stopPropagation(); // Prevent category click

                    const categoryItem = this.closest('.category-item');
                    const level = parseInt(this.dataset.level);

                    // Only update if this category is selected
                    if (categoryItem.classList.contains('selected')) {
                        // Update level buttons in this category
                        categoryItem.querySelectorAll('.level-btn').forEach(b => {
                            b.classList.remove('selected');
                        });
                        this.classList.add('selected');

                        // Update game state
                        gameState.currentLevel = level;
                        console.log("Selected level:", gameState.currentLevel);
                    }
                });
            });

            // Game mode selection - SIMPLIFIED
            document.querySelectorAll('input[name="gameMode"]').forEach(radio => {
                radio.addEventListener('change', function () {
                    console.log("Game mode changed to:", this.value);
                    gameState.mode = this.value;
                    const playerNamesGroup = document.getElementById('playerNamesGroup');
                    const player2ScoreCard = document.getElementById('player2ScoreCard');

                    if (this.value === 'multi') {
                        playerNamesGroup.classList.remove('hidden');
                        player2ScoreCard.classList.remove('hidden');
                    } else {
                        playerNamesGroup.classList.add('hidden');
                        player2ScoreCard.classList.add('hidden');
                    }
                });
            });

            // Question count selection
            document.getElementById('questionCount').addEventListener('change', function () {
                gameState.totalQuestions = parseInt(this.value);
                console.log("Total questions:", gameState.totalQuestions);
            });

            // Start Game button - SIMPLIFIED
            document.getElementById('startGame').addEventListener('click', function () {
                console.log("Start Game clicked");

                // Get player names if multiplayer
                if (gameState.mode === 'multi') {
                    gameState.player1Name = document.getElementById('player1Name').value || 'Player 1';
                    gameState.player2Name = document.getElementById('player2Name').value || 'Player 2';

                    document.getElementById('player1NameDisplay').textContent = gameState.player1Name;
                    document.getElementById('player2NameDisplay').textContent = gameState.player2Name;
                } else {
                    document.getElementById('player1NameDisplay').textContent = 'You';
                }

                // Reset game state
                gameState.currentQuestion = 0;
                gameState.player1Score = 0;
                gameState.player2Score = 0;
                gameState.gameActive = true;
                gameState.currentPlayer = 1;
                gameState.questionsAnswered = 0;
                gameState.selectedOption = null;

                // Update UI
                document.getElementById('gameSetup').classList.add('hidden');
                document.getElementById('gameActive').classList.remove('hidden');
                document.getElementById('answerSection').classList.add('hidden');
                document.getElementById('resultFeedback').textContent = '';
                document.getElementById('logEntries').innerHTML = '';
                document.getElementById('optionsContainer').innerHTML = '';

                // Update displays
                document.getElementById('player1Score').textContent = '0';
                document.getElementById('player2Score').textContent = '0';

                if (gameState.mode === 'multi') {
                    document.getElementById('currentPlayerDisplay').classList.remove('hidden');
                    updateCurrentPlayerDisplay();
                } else {
                    document.getElementById('currentPlayerDisplay').classList.add('hidden');
                }

                updatePlayerScoreCards();
                updateQuestionCounter();

                // Enable shoot button
                document.getElementById('shootBtn').disabled = false;
                document.getElementById('questionText').textContent = 'Click "GENERATE QUESTION" to get your first question';

                // Add log entry
                const categoryNames = {
                    multiplication: 'Multiplications & Squares',
                    mixed: 'Mixed Operations',
                    algebra: 'Algebra & Equations'
                };
                addLogEntry(`Game started! Category: ${categoryNames[gameState.currentCategory]} - Level ${gameState.currentLevel}`);

                console.log("Game started successfully");
            });

            // Shoot button - generate question - SIMPLIFIED
            document.getElementById('shootBtn').addEventListener('click', function () {
                console.log("Shoot button clicked");
                if (!gameState.gameActive) {
                    console.log("Game not active");
                    return;
                }

                // Check if game is over
                if (gameState.questionsAnswered >= gameState.totalQuestions) {
                    endGame();
                    return;
                }

                // Get random question from selected category and level
                const levelKey = 'level' + gameState.currentLevel;
                const questions = questionBank[gameState.currentCategory][levelKey];

                if (questions.length === 0) {
                    alert('No questions available for this category and level!');
                    return;
                }

                const randomIndex = Math.floor(Math.random() * questions.length);
                gameState.currentQuestionData = questions[randomIndex];
                gameState.currentQuestion++;

                // Generate SMART options
                const options = generateOptions(gameState.currentQuestionData.answer, gameState.currentQuestionData.question);

                // Update UI
                document.getElementById('questionText').innerHTML = gameState.currentQuestionData.question;
                document.getElementById('questionLevel').textContent = `Level ${gameState.currentLevel}`;
                document.getElementById('questionLevel').className = `question-level level-${gameState.currentLevel}`;

                // Create option buttons
                const optionsContainer = document.getElementById('optionsContainer');
                optionsContainer.innerHTML = '';

                options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.className = 'option-btn';
                    button.textContent = option;
                    button.dataset.value = option;
                    button.dataset.index = index;

                    button.addEventListener('click', function () {
                        console.log("Option clicked:", this.dataset.value);
                        // Remove selected class from all options
                        document.querySelectorAll('.option-btn').forEach(btn => {
                            btn.classList.remove('selected');
                        });

                        // Add selected class to clicked option
                        this.classList.add('selected');
                        gameState.selectedOption = this.dataset.value;
                        document.getElementById('submitAnswer').disabled = false;
                    });

                    optionsContainer.appendChild(button);
                });

                // Show answer section
                document.getElementById('answerSection').classList.remove('hidden');
                document.getElementById('resultFeedback').textContent = '';
                document.getElementById('submitAnswer').disabled = true;
                gameState.selectedOption = null;

                // Update question counter
                updateQuestionCounter();

                // Add log entry
                const categoryNames = {
                    multiplication: 'Multiplication',
                    mixed: 'Mixed Operations',
                    algebra: 'Algebra'
                };
                addLogEntry(`${getCurrentPlayerName()} received a ${categoryNames[gameState.currentCategory]} question`);

                // Disable shoot button until answer is submitted
                this.disabled = true;

                console.log("Question generated successfully");
            });

            // Submit answer button - SIMPLIFIED
            document.getElementById('submitAnswer').addEventListener('click', function () {
                console.log("Submit button clicked");
                checkAnswer();
            });

            // Initial log entries
            addLogEntry("Welcome to The MathMaze - Advanced Challenge!");
            addLogEntry("Select a category and level, then click 'Start Game' to begin!");

            console.log("Game initialization complete");
        });
    </script>
</body>

</html>